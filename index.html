<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta encoding="UTF-8">
    <title>To-do list | AstrusWeb</title>
    <link rel="stylesheet" href="bootstrap.min.css">
    <style>
      td textarea {
        resize:both;
        min-width: 100%;
      }
      #alerts {
        position: fixed;
        opacity: 0;
        top: -15px;
        left: 50%;
        transform: translate(-50%);
        transition: all 150ms ease-out;
        pointer-events: none;
      }
      #alerts.show {
        pointer-events: initial;
        top:15px;
        opacity: 1;
      }
    </style>
  </head>
  <body>
    <div class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container">
        <span class="navbar-brand">Astrusweb</span>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav">
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" id="themes" aria-expanded="false">Locaweb <span class="caret"></span></a>
              <div class="dropdown-menu" aria-labelledby="locaweb">
                <a class="dropdown-item" href="https://gagarin1806.hospedagemdesites.ws:2083">cpanel</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item"
                  href="https://gagarin1806.hospedagemdesites.ws:2087">admin</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="https://www.locaweb.com.br/atendimento/">central do cliente</a>
              </div>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://faq.astrusweb.com">FAQ</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://app.sortweb.me/">Sortweb</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" id="Dataware" aria-expanded="false">Dataware <span class="caret"></span></a>
              <div class="dropdown-menu" aria-labelledby="Dataware">
                <a class="dropdown-item" rel="noopener" target="_blank" href="http://atendimento.dataware.com.br/">Atendimentos</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="https://web.dataware.com.br/" rel="noopener" target="_blank">E-mails</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item"
                  href="https://web.dataware.com.br/Certificado" rel="noopener"
                  target="_blank">Certificados</a>
              </div>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" id="Planilhas" aria-expanded="false">Planilhas <span class="caret"></span></a>
              <div class="dropdown-menu" aria-labelledby="Planilhas">
                <a class="dropdown-item" rel="noopener" target="_blank" href="https://docs.google.com/spreadsheets/d/1iA-KJCmlkqRiAJm0osTSOtcjDfIhEVjrgkOYNwtlEcI/edit?usp=sharing">Pagamento - Domínios</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="https://docs.google.com/spreadsheets/d/1lWzcyJ5097hO8R-9g99GV5Wu27Plzg1Y9XW57i68U1o/edit?usp=sharing" rel="noopener" target="_blank">Leads - Novos clientes</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item"
                  href="https://docs.google.com/spreadsheets/d/1nr3vaSvSKfaDL8dCiYrlY0Ff6XfU6D27t5N6XHLd5qs/edit?ts=60ad4d34#gid=0"
                  rel="noopener" target="_blank">Certificados - Projetos</a>
              </div>
            </li>
            <li class="nav-item">
              <a target="_blank" rel="noopener" class="nav-link" href="https://repositorio.astrusweb.com/">Repositório</a>
            </li>
          </ul>
          <ul class="navbar-nav ms-md-auto">
            <li style="padding-right: 20px;" class="nav-item d-flex align-items-center">
              <button id="openAuditLogsBtn" class="btn btn-info btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#audit-logs-list" aria-expanded="false" aria-controls="collapseExample">
                Registros
              </button>
            </li>
            <li class="nav-item d-flex align-items-center">
              <button id="openConfiguracoesBtn" class="btn btn-muted btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#configuracoesDiv" aria-expanded="false" aria-controls="collapseExample">
                Configurações
              </button>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="collapse " id="configuracoesDiv">
        <!-- col-md-3 offset-md-9 -->
        <div class="card border-muted rounded-0 mb-3" >
          <div class="card-header">Configurações</div>
          <div class="card-body">
            <h5 class="card-title">Usuário</h5>
            <p class="card-text">Defina o nome de usuário utilizado no registro de suas atividades.</p>
            <div class="form-group">
              <label for="defineUsuario" class="form-label mt-0">Selecione seu nome na lista.</label>
              <select class="form-select" id="defineUsuario" style="max-width:20rem;">
              </select>
              <small></small>
            </div>
            <h5 class="card-title mt-4">Paginação</h5>
            <p class="card-text">Defina a quantidade de resultados por página.</p>
            <div class="form-group">
              <label for="definePaginacao" class="form-label mt-0">Selecione uma quantidade na lista.</label>
              <select class="form-select" id="definePaginacao" style="max-width:20rem;">
                <option>10</option>
                <option>15</option>
                <option>20</option>
                <option>25</option>
                <option>50</option>
                <option>75</option>
                <option>100</option>
              </select>
              <small class="text-warning">Valores maiores de 50 podem causar lentidão!</small>
            </div>
          </div>
        </div>
      </div>


      <div class="collapse" id="audit-logs-list">
        <ul class="list-group">
        </ul>
      </div>


    </div>

    <div class='container'>
      <div class="page-header">
        <div class="row">
          <div class="col-lg-8 col-md-7 col-sm-6">
            <h1>Atendimentos</h1>
            <p class="lead">Listagem de atendimentos do desenvolvimento</p>
          </div> 
          <div class="col-lg-2 col-md-5 col-sm-6 d-flex align-items-center justify-content-center flex-row">
            <p id="active-users" class="mb-0 text-info">
              <span id="active-users-count">1</span> usuário(s) online.
            </p>
            <div style="width:15px; height:15px; border-radius:80%;" class="progress">
              <div class="progress-bar progress-bar-striped bg-success progress-bar-animated" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%;"></div>
            </div>
          </div>
        </div>
      </div>
      <section id="functions-wrapper">
        <div class="row"> 
          <form id="new-atendimento">
            <fieldset>
              <legend>Registro de novo atendimento</legend>
              <fieldset class="row">
                <div class="form-group col-lg-2">
                  <label for="usuarios_dropdown" class="form-label">Atendente</label>
                  <input autocomplete="off" required="required" data-bs-toggle="dropdown" aria-expanded=false class="form-control dropdown-toggle" type="text" placeholder="Atendente" value="" name="user_id" id="usuarios_dropdown">
                  <div class="dropdown-menu" role="menu"></div>
                </div>
                <div class="form-group col-lg-2">
                  <label for="cliente" class="form-label">Cliente</label>
                  <input autocomplete="off" required="required" class="dropdown-toggle form-control" type="text" placeholder="Cliente" value="" name="client_id" id="cliente_dropdown" data-bs-toggle="dropdown" aria-expanded=false>
                  <div class="dropdown-menu" role="menu"></div>
                </div>
                <div class="form-group col-lg-2">
                  <label for="ticket" class="form-label"># Ticket<small id="ticket-help" class="form-text text-muted"> (opcional).</small></label>
                  <input aria-describedby="ticket-help" class="form-control" type="text" placeholder="# ticket" value="" name="ticket" id="ticket">
                  
                </div>
                <div class="form-group col-lg-2">
                  <label for="data_atendimento" class="form-label">Data atendimento</label>
                  <input required="required" class="form-control" type="date" placeholder="" value="" name="data_atendimento" id="data_atendimento">
                </div>
                <div class="form-group col-lg-2">
                  <label for="data_retorno" class="form-label">Data de retorno</label>
                  <input required="required" class="form-control" type="date" placeholder="" value="" name="data_retorno" id="data_retorno">
                </div>
                <div class="form-group col-lg-2">
                  <label for="" class="form-label">Plataforma</label>
                  <input required="required" class="form-control" type="text" placeholder="Plataforma" value="" name="plataforma" id="plataforma">
                </div>
              </fieldset>
              <fieldset class="row mt-1">
                <div class="form-group col-lg-12">
                  <label for="obs" class="form-label">Descrição e observações</label>
                  <textarea required="" class="form-control" rows="2" placeholder="Descrição e observações sobre o chamado." value="" name="obs" id="obs"></textarea>
                </div>
              </fieldset>
              <fieldset class="row mt-2">
                <div class="form-group col-lg-2">
                  <input required="required" class="btn btn-primary" type="submit" value="Enviar" id="addRowBtn">
                </div>
                <div class="col-lg-8">
                  <span id="error-span"></span>
                </div>
              </fieldset>
            </fieldset>
          </form>
        </div>
        <div class="row mt-4 col-lg-12">
          <!-- <h3 class="">Filtrar atendimentos</h3> -->
          <form id="filter-form" class="">
              <fieldset class="row">
                <fieldset class="col-lg-4">
                  <!-- <legend>Filtrar por cliente</legend> -->
                  <div class="form-group">
                    <label class="form-label" for="filter-clientes">Filtrar por cliente</label>
                    <input autocomplete="off" class="form-control" aria-describedby="filter-clientes-help" type="text" placeholder="Selecione um cliente na lista" id="filter-clientes" data-bs-toggle="dropdown" aria-expanded=false name="filter-clientes">
                    <div class="dropdown-menu" role="menu"></div>
                    <small id="filter-clientes-help" class="form-text text-muted">Deixe em branco para remover o filtro.</small>
                  </div>
                </fieldset>
                <fieldset class="col align-items-center col-lg-2">
                  <!-- <legend>Filtrar por Status</legend> -->
                  <div class="col-lg-12">
                    <input class="form-check-input" type="checkbox" checked="" value="" id="filter-status-aberto" name="filter-status-1">
                    <label class="form-check-label" for="filter-status-aberto">
                      Abertos
                    </label>
                  </div>
                  <div class="col-lg-12">
                    <input class="form-check-input" type="checkbox" checked="" value="" name="filter-status-2" id="filter-status-fechado">
                    <label class="form-check-label" for="filter-status-fechado">
                      Fechados
                    </label>
                  </div>
                  <div class="col-lg-12">
                    <input class="form-check-input" type="checkbox" name="filter-status-3" id="filter-status-deletado">
                    <label class="form-check-label" for="filter-status-deletado">
                      Deletados
                    </label>
                  </div>
                </fieldset>
                <fieldset class="col col-lg-3">
                  <!-- <legend>Filtrar por ticket</legend> -->
                  <div class="form-group">
                    <label class="form-label" for="filter-tickets">Filtrar por ticket</label>
                    <input autocomplete="off" class="form-control" aria-describedby="filter-tickets-help" type="text" placeholder="# do ticket" id="filter-tickets" name="filter-tickets">
                    <small id="filter-tickets-help" class="form-text text-muted">Deixe em branco para remover.</small>
                  </div>
                </fieldset>
                <fieldset class="col col-lg-3">
                  <!-- <legend>Filtrar por ticket</legend> -->
                  <div class="form-group">
                    <label class="form-label" for="filter-description">Filtrar por Descrição</label>
                    <textarea style="min-height:36px;resize:both;height:36px;"
                      class="form-control" rows="1" placeholder="Escreva um trecho da descrição"
                      value="" name="filter-description" id="filter-description"></textarea>
                    <small id="filter-description-help" class="form-text text-muted">Deixe em branco para remover.</small>
                  </div>
                </fieldset>
              </fieldset>
          </form>
        </div>
      </section>
      <section id="table-wrapper"></section>
      <div class='row'>
        <div class='col-lg-4'>
          <figure>
            <blockquote class="blockquote">
              <p class="mb-0">Proibido visualizar e não responder.</p>

            </blockquote>
            <figcaption class="blockquote-footer">
              Pessoa que já deixou <cite title="Source Title">os clientes putos</cite>
            </figcaption>
          </figure>
        </div>
        <div class='col-lg-4'>
          <figure>
            <blockquote class="blockquote">
              <p class="mb-0">Sempre peça para enviar por e-mail.</p>

            </blockquote>
            <figcaption class="blockquote-footer">
              Pessoa que já se viu acusada <cite title="Source Title">sem provas</cite>
            </figcaption>
          </figure>
        </div>
        <div class='col-lg-4'>
          <figure>
            <blockquote class="blockquote">
              <p class="mb-0">O que registramos nesta vida, ecoa pela eternidade.</p>

            </blockquote>
            <figcaption class="blockquote-footer">
              Maximus Decimus <cite title="Source Title">Meridius</cite>
            </figcaption>
          </figure>
        </div>
      </div>

    </div>
    <section id="alerts" class="alert alert-info">Aperte <kbd>ESC</kbd> novamente para limpar os filtros.</section>

    <script src="/socket.io/socket.io.js"></script>
    <script src="./socket.js"></script>
    <script src="./table.js"></script>
    <script id="scripts">
      var s = new Socket();
      var table = new Table(s);

      s.socket.on('user count', (total) => s.updateUserCounter(total));
      s.socket.on('novo atendimento', (newAtd) => table.appendExistingRows([newAtd]));
      s.socket.on('atualiza obs', (newObs) => table.atualizaObs(newObs));
      s.socket.on('add ticket', (addedTicket) => table.handleAddTicket(addedTicket));
      s.socket.on('atualiza status', (newStatus) => table.handleAtualizaStatus(newStatus));
      s.socket.on('log', (log) => table.appendLog(log, document.querySelector('#audit-logs-list ul')));

      // cacheia seletores usados mais de uma vez

      var filterDescriptionTextArea = table.checkSelector('#filter-description');
      var alertSection = table.checkSelector('#alerts');

      table.createTable();
      table.loadRowsFromDatabase(1, table.perPage, 'desc');
      table.addFormFunctions();
      table.insertAtendimento('#new-atendimento');

      var searchInput = table.enableClientFilter('#filter-clientes');
      var ticketsFilterInput = table.enableTicketsFilter('#filter-tickets');

      table.enableDescriptionFilter(filterDescriptionTextArea);

      var filtersForm = table.preventFormSubmit('#filter-form');
      table.enableStatusFilter();
      table.generateConfirmModal("body", "#scripts");
      table.defineUser("#openConfiguracoesBtn");


      window.onkeydown = function(e) {
        // sobrescreve ctrl + f
        table.focusOnDescriptionFilter(e, filterDescriptionTextArea);
        // limpa filtros com duplo tap no esc
        table.removeAllFilters(e, alertSection);
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>

  </body>
</html>
